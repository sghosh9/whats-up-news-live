var appGlobal=function(){return{formatDateTwoDigits:function(e){return 10>e?"0"+e:e},isAlphaNumeric:function(e){var t=/^[A-Za-z0-9\-\s]+$/;return e.match(t)}}}();_.template.formatDate=function(e){var t=new Date(1e3*e);return t.getUTCFullYear()+"-"+(t.getUTCMonth()+1)+"-"+t.getUTCDate()+" "+appGlobal.formatDateTwoDigits(t.getUTCHours())+":"+appGlobal.formatDateTwoDigits(t.getUTCMinutes())},$(function(){var e="27c99f6f19554a2b84566fb9d1744b10",t="https://newsapi.org/v2/everything?apiKey="+e,s=Backbone.Model.extend({defaults:{publishedAt:0,title:"",url:"",author:"",source:""},parse:function(e){null==e.author&&(e.author="");var t=Date.parse(e.publishedAt);return t/=1e3,e.publishedAt=t,e.source=e.source.name,e}}),r=Backbone.Collection.extend({model:s,url:t,parse:function(e){return e.articles},sortColumn:"publishedAt",sortDirection:-1,sortNews:function(){this.sort()},comparator:function(e,t){var s=e.get(this.sortColumn),r=t.get(this.sortColumn);return s="string"==typeof s?s.toLowerCase():s,r="string"==typeof r?r.toLowerCase():r,s==r?0:1==this.sortDirection?s>r?1:-1:r>s?1:-1}}),i=Backbone.View.extend({tagName:"tr",template:_.template($("#row-template").html()),render:function(){return this.$el.html(this.template(this.model.attributes)),this}}),o=Backbone.View.extend({el:$("#results"),events:{"click table th":"headerClick","change #results-filter .field-filter":"newsFilter",reset:"resetForm"},sortClasses:{asc:"sort-asc",desc:"sort-desc"},selectFilterTemplate:_.template($("#filter-select").html()),initialize:function(){this.listenTo(this.collection,"sort sync",this.render)},headerClick:function(e){var t=$(e.currentTarget),s=t.attr("column"),r=this.collection.sortColumn;this.collection.sortColumn=s,s==r?this.collection.sortDirection*=-1:this.collection.sortDirection=1,this.collection.sortNews()},newsFilter:function(){var e=this.$("#results-filter .form-wrapper"),t={};_(e.find(".field-filter")).each(function(e){$(e).val()&&(t[$(e).attr("name")]=$(e).val(),t.active=!0)}),this.render(t)},resetForm:function(){this.$("#results-filter .field-filter").val(null).trigger("change"),this.render(this.collection)},render:function(e){var t=this.collection.models;if(t.length>0){var s=this.$("tbody"),r=this.$("#results-filter .form-wrapper"),o={},l={};s.empty(),_(t).each(function(e){e.get("author")&&(o[e.get("author")]=e.get("author")),e.get("source")&&(l[e.get("source")]=e.get("source"))}),0==r.find(".filter").length&&(r.prepend(this.selectFilterTemplate({id:"source",label:"Source",filterValues:l})),r.prepend(this.selectFilterTemplate({id:"author",label:"Author",filterValues:o})),r.find(".field-filter").select2()),e.active&&(delete e.active,t=this.collection.where(e)),_(t).each(function(e){var t=new i({model:e});s.append(t.render().el)}),this.$('thead th[class*="sort"]').removeClass(this.sortClasses.asc+" sort "+this.sortClasses.desc);var a=this.$('thead th[column="'+this.collection.sortColumn+'"]');return 1===this.collection.sortDirection?a.addClass(this.sortClasses.asc+" sort"):a.addClass(this.sortClasses.desc+" sort"),$("#main").addClass("showing-results"),this}$("#main").removeClass("showing-results")}}),l=Backbone.Model.extend({searchInput:"",initialize:function(){this.newscollection=new r({parse:!0}),this.newsview=new o({collection:this.newscollection})},newsSearch:function(e){$("#search-loader").removeClass("hide"),this.newscollection.fetch({reset:!0,data:{q:e},success:function(){$("body").removeClass("no-results search-init"),$("#search-loader").addClass("hide")},error:function(){$("body").removeClass("no-results search-init"),$("#search-loader").addClass("hide")}})}}),a=Backbone.View.extend({el:$("#news-search"),events:{"keyup .field-search":_.debounce(function(e){this.triggerSearch(e)},500),"keyup input":"startType",submit:"triggerSearch",reset:"resetForm"},startType:function(e){var t=$(e.currentTarget).val();t?this.$(".form-reset").removeClass("hide"):(this.$(".form-reset").addClass("hide"),$("body").addClass("no-results"))},triggerSearch:function(e){e.preventDefault();var t=e.type,s=this.model.searchInput,r="";switch(t){case"keyup":var r=$(e.currentTarget).val();break;case"submit":var r=this.$('input[name="search"]').val()}r&&appGlobal.isAlphaNumeric(r)&&r!=s&&(this.model.searchInput=r,this.model.newsSearch(r))},resetForm:function(){this.$('input[name="search"]').focus(),this.$(".form-reset").addClass("hide"),$("body").addClass("no-results"),$("#results-filter .filter").remove()}}),n=new l;new a({model:n}),$("select").select2()});
